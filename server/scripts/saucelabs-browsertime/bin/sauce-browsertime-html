#!/usr/bin/env node

var fs = require('fs');
var path = require('path');

var dir = path.join(__dirname, '../test/templates');
var body = fs.readFileSync(path.join(dir, 'index.html'), 'utf8');

var argv = process.argv.slice(2);
var json = require(path.resolve(argv[0]));
var browser = argv[1] || 'chrome';

var hogan = require('hogan.js');
var tpl = hogan.compile(body);

var title = '';
if (process.env.BUILD_NUMBER) title = 'This page shows raw metrics generated by saucelabs-browsertime for the build ' + process.env.BUILD_NUMBER;

console.log(tpl.render({
  title: title,
  browser: browser,
  metrics: json.tests.map(function(t) {
    t.timingsJSON = JSON.stringify(t.duration);
    return t;
  })
}));
