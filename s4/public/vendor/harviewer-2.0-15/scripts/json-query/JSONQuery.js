(function(){function distinctFilter(a,b){var c=[],d={};for(var e=0,f=a.length;e<f;++e){var g=a[e];b(g,e,a)&&(typeof g=="object"&&g?g.__included||(g.__included=!0,c.push(g)):d[g+typeof g]||(d[g+typeof g]=!0,c.push(g)))}for(e=0,f=c.length;e<f;++e)c[e]&&delete c[e].__included;return c}function expand(a,b){function d(a){b&&(b!==!0||a instanceof Array?a[b]&&c.push(a[b]):c.push(a));for(var e in a){var f=a[e];b?f&&typeof f=="object"&&d(f):c.push(f)}}var c=[];if(b instanceof Array){if(b.length==1)return a[b[0]];for(var e=0;e<b.length;e++)c.push(a[b[e]])}else d(a);return c}function slice(a,b,c,d){var e=a.length,f=[];c=c||e,b=b<0?Math.max(0,b+e):Math.min(e,b),c=c<0?Math.max(0,c+e):Math.min(e,c);for(var g=b;g<c;g+=d)f.push(a[g]);return f}function filter(a,b){var c=a.length;if(typeof b!="function")throw new TypeError;var d=[],e=arguments[2];for(var f=0;f<c;f++)if(f in a){var g=a[f];b.call(e,g,f,a)&&d.push(g)}return d}function map(a,b){var c=a.length;if(typeof b!="function")throw new TypeError;var d=Array(c),e=arguments[2];for(var f=0;f<c;f++)f in a&&(d[f]=b.call(e,a[f],f,a));return d}var JSONQuery=function(query,obj){function makeRegex(a,b,c,d,e){return str[e].match(/[\*\?]/)||d=="~"?"/^"+str[e].substring(1,str[e].length-1).replace(/\\([btnfr\\"'])|([^\w\*\?])/g,"\\$1$2").replace(/([\*\?])/g,".$1")+(d=="~"?"$/i":"$/")+".test("+b+")":a}function call(a){prefix=a+"("+prefix}tokens=[];var depth=0,str=[];query=query.replace(/"(\\.|[^"\\])*"|'(\\.|[^'\\])*'|[\[\]]/g,function(a){depth+=a=="["?1:a=="]"?-1:0;return a=="]"&&depth>0?"`]":a.charAt(0)=='"'||a.charAt(0)=="'"?"`"+(str.push(a)-1):a});var prefix="";query.replace(/(\]|\)|push|pop|shift|splice|sort|reverse)\s*\(/,function(){throw new Error("Unsafe function call")}),query=query.replace(/([^=]=)([^=])/g,"$1=$2").replace(/@|(\.\s*)?[a-zA-Z\$_]+(\s*:)?/g,function(a){return a.charAt(0)=="."?a:a=="@"?"$obj":(a.match(/:|^(\$|Math|true|false|null)$/)?"":"$obj.")+a}).replace(/\.?\.?\[(`\]|[^\]])*\]|\?.*|\.\.([\w\$_]+)|\.\*/g,function(a,b,c){var d=a.match(/^\.?\.?(\[\s*\^?\?|\^?\?|\[\s*==)(.*?)\]?$/);if(d){var e="";a.match(/^\./)&&(call("expand"),e=",true)"),call(d[1].match(/\=/)?"map":d[1].match(/\^/)?"distinctFilter":"filter");return e+",function($obj){return "+d[2]+"})"}d=a.match(/^\[\s*([\/\\].*)\]/);if(d)return".concat().sort(function(a,b){"+d[1].replace(/\s*,?\s*([\/\\])\s*([^,\\\/]+)/g,function(a,b,c){return"var av= "+c.replace(/\$obj/,"a")+",bv= "+c.replace(/\$obj/,"b")+";if(av>bv||bv==null){return "+(b=="/"?1:-1)+";}\nif(bv>av||av==null){return "+(b=="/"?-1:1)+";}\n"})+"})";d=a.match(/^\[(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)\]/);if(d){call("slice");return","+(d[1]||0)+","+(d[2]||0)+","+(d[3]||1)+")"}if(a.match(/^\.\.|\.\*|\[\s*\*\s*\]|,/)){call("expand");return(a.charAt(1)=="."?",'"+c+"'":a.match(/,/)?","+a:"")+")"}return a}).replace(/(\$obj\s*(\.\s*[\w_$]+\s*)*)(==|~)\s*`([0-9]+)/g,makeRegex).replace(/`([0-9]+)\s*(==|~)\s*(\$obj(\s*\.\s*[\w_$]+)*)/g,function(a,b,c,d,e){return makeRegex(a,d,e,c,b)}),query=prefix+(query.charAt(0)=="$"?"":"$")+query.replace(/`([0-9]+|\])/g,function(a,b){return b=="]"?"]":str[b]});var executor=eval("1&&function($,$1,$2,$3,$4,$5,$6,$7,$8,$9){var $obj=$;return "+query+"}");for(var i=0;i<arguments.length-1;i++)arguments[i]=arguments[i+1];return obj?executor.apply(this,arguments):executor};typeof namespace=="function"?namespace("json::JSONQuery",JSONQuery):window.JSONQuery=JSONQuery})()