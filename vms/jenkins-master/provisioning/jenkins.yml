---
- hosts: all
  sudo: yes
  tasks:

    #- name: ensure epel thing is there
    #  get_url: dest=/tmp/epel-release-6-8.noarch.rpm url=http://dl.fedoraproject.org/pub/epel/6/i386/epel-release-6-8.noarch.rpm

    #- name: ensure epel thing is there, phase two
    #  ignore_errors: yes
    #  command: rpm -Uvh /tmp/epel-release-6-8.noarch.rpm

    - name: ensure yum dependencies are installed
      action: yum name={{ item }} state=present
      with_items:
        - vim-enhanced
        - java-1.6.0-openjdk
        - httpd

    - name: Jenkins install
      get_url: dest=/etc/yum.repos.d/jenkins.repo url=http://pkg.jenkins-ci.org/redhat/jenkins.repo

    - name: Install Jenkins RPM
      ignore_errors: yes
      command: rpm --import http://pkg.jenkins-ci.org/redhat/jenkins-ci.org.key
      
    - name: Jenkins pkg install
      yum: name=jenkins state=present

    - name: Setup HTTP reverse proxy
      action: template src=templates/apache.conf dest=/etc/httpd/conf.d/jenkins.conf

    - name: Start Services
      service: name={{ item }} state=restarted
      with_items:
        - jenkins
        - httpd
